### **作者**  
中村 友梨香

## **アプリ名**  
**うまマップ**  

## **コンセプト**  
**マップから選択できる！店舗検索アプリ**  

## **デモ動画**  
2分程度のデモ動画をGoogleドライブに用意しました。
[デモ動画（Google Drive）](https://drive.google.com/file/d/1poCM_zyVoK3ZT1v6AgZrg_yVrjqmvMTK/view?usp=sharing)

## **こだわったポイント**  

### **バックエンド**  
以下のサイトを参考にして、**Laravelの命名規則**を遵守しながら開発を行いました。  
[【laravel】laravelの命名規則](https://qiita.com/gone0021/items/e248c8b0ed3a9e6dbdee)

- **クラス名:** アッパーキャメルケース (例: `ShopController`)  
- **変数名:** ローワーキャメルケース (例: `$shopDetail`)  
- **データベースのカラム名:** スネークケース (例: `shop_name`)  

### **フロントエンド**  
- 以下の順番でコードを記述し、統一しました。
  1. **インポート**
  2. **コンポーネントの定義**  
  3. **useState**
  4. **useEffect**
  5. **変数・関数の定義**  
  6. **return（JSX）**  

- **フォルダ構成の整理**  
  - 各画面ごとにフォルダを作成し、管理しやすくしました。  
  - スピナー表示やボタンなどを共通コンポーネントとして作成し、再利用可能な形に整理しました。  

- **デザイン面でこだわったポイント**
  - レスポンシブデザインを作成しました。
  - APIのデータ取得時にローディング表示を導入し、待ち時間のストレスを軽減しました。
  - ボタンの連打防止処理を実装(ボタン押下後はローディングを表示し、再クリックを無効化)しました。  
  - 検索条件の未選択時にはボタンをグレーにして無効化し、操作ミスを防止しました。
  - いいねボタンをうまー！ボタンを表記しました。
    - 個人の意見になりますが、「このお店いいよ！」と言われるよりも「このお店美味しかったよ！」と言われる方が嬉しいと感じたからです。

## **該当プロジェクトのリポジトリ URL（GitHub, GitLab など）**  
https://github.com/15-y-nakamura/UmaMap

## **開発環境**  

### **開発環境**  
- **Docker**  
- **VSCode**  

### **開発言語**  
- **バックエンド:** PHP 8.2 (Laravel 11)  
- **フロントエンド:** JavaScript (React 18, Vite 6)  
- **データベース:** MySQL  

## **テーブル定義 (ER図) などの設計ドキュメント（ウェブアプリ）**  
ER図、テーブル設計、API一覧をGoogleドライブにまとめています。  
[設計ドキュメント（Google Drive）](https://drive.google.com/drive/folders/1Pr4CoXyACt-zsX7-ps0xGvpsyT8B55o6?usp=sharing)

## **環境構築手順**  

### **リポジトリをクローン**  
```sh
git clone https://github.com/15-y-nakamura/UmaMap.git
cd UmaMap
```

### **必要な依存関係をインストール**  
```sh
composer install
npm install
```
`npm install` の際、以下の警告が表示されることがありますが、
@inertiajs/react に内部依存しているため、問題なく利用できます。  
  ```sh
  npm WARN deprecated lodash.isequal@4.5.0: This package is deprecated. Use require('node:util').isDeepStrictEqual instead.
  ```
`"lodash.isequal": "^4.5.0"` は **非推奨** ですが、
@inertiajs/react で使用されているため、そのまま利用しています。  

### **環境変数ファイルを設定**  
```sh
cp .env.example .env
php artisan key:generate
```
`.env.example` を参考に `.env` ファイルを作成し、必要な値を設定してください。  

### **データベースを設定し、マイグレーションを実行**  
```sh
./vendor/bin/sail up -d
./vendor/bin/sail php artisan migrate
```

### **アプリケーションを実行**  
```sh
npm run dev
```

## **動作対象端末・OS**  

### **動作確認済みOS**  
- **Windows 11**  

### **動作確認済みブラウザ**  
- **Google Chrome（最新）**  
- **Microsoft Edge（最新）**  

## **開発期間**
- 全体の開発期間: 2週間（合計120~130時間程）
- 1日あたりの開発時間: アルバイトがある日は7時間、それ以外の日は12時間を目安に作業しました。
  - 1週目: 環境構築、検索機能、マップ表示、店舗詳細の実装
  - 2週目: 認証機能、いいね機能、データの表示調整、バグ修正、UI改善

## **アプリケーション機能**  

### **機能一覧**  
- **ログイン:** 既存ユーザーがアカウントにログイン  
- **新規登録:** 新しいユーザーがアカウントを作成  
- **ログアウト:** 現在のセッションを終了  
- **飲食店検索:** ホットペッパーグルメサーチAPIを使用して、条件に合った飲食店を検索、検索結果をマップで表示 
- **飲食店詳細表示:** ホットペッパーグルメサーチAPIを使用して、店舗の詳細情報を取得
  - **「うまー！」機能搭載:**  
    - 1人1回まで「うまー！」を押せる  
    - 「うまー！」のカウント数は全ユーザーに表示される
- **うまー！履歴表示:** 過去にうまー！を押した店舗を表示、削除可能

## **画面一覧**  

### **ログイン画面**  
- ユーザーがログイン可能  
- エラー発生時にカスタムエラーメッセージを表示  

### **新規登録画面**  
- ユーザーの新規登録が可能  
- エラー発生時にカスタムエラーメッセージを表示  

### **ヘッダー**  
- **ログイン時:** ログアウト、店舗検索、うまー！履歴のルートを表示  
- **ログアウト時:** ログイン、新規登録、店舗検索のルートを表示  

### **店舗検索画面**  
- **検索条件:**  
  - **場所:** 現在位置, 東京, 大阪, 名古屋, 福岡  
  - **検索範囲 (m):** 300, 500, 1000, 2000, 3000  
  - **予算:** 500円~30000円の13種類  
  - **ジャンル:** 居酒屋, ダイニングバー, 和食, 洋食, イタリアン・フレンチ, カフェ・スイーツ など  
- **マップ表示:**  
  - **サークルで検索範囲を表示**  
  - **ピンで検索結果の店舗位置を表示**  
- **検索結果:**  
  - 5件ずつページングで表示
- 「もっと見る」リンクで該当店舗の詳細画面に移動可能  

### **店舗詳細画面**  
- **基本情報:**  
  - 店名、住所、メインジャンル、サブジャンル、キャッチコピー  
  - 収容人数、Wi-Fi有無、喫煙情報、駐車場情報  

- **アクセス情報:**  
  - エリア、最寄り駅、アクセス、地図情報 (OpenStreetMapを使用)  

- **「うまー！」機能:**  
  - ユーザーは1回のみ「うまー！」を押せる  
  - うまー！のカウント数は全ユーザーに表示される  

- **オプション:**  
  - **カード表示で店舗の設備をわかりやすく表示**  
    - 各オプション (コース料理、飲み放題、WiFi、ペット可、子供連れOK など) に応じて、利用可能なものは白背景、利用不可なものはグレー背景に切り替え

### **うまー！履歴画面** 
  - ユーザーが押した「うまー！」を日付ごとにグループ化して表示  
  - 各履歴は選択して削除可能  
  - 「もっと見る」リンクで該当店舗の詳細画面に移動可能

## **使用している API, SDK, ライブラリなど**  
- **ホットペッパーグルメサーチAPI**  
- **マップ関連**  
  - Leaflet 1.9.4  
  - React-Leaflet 4.2.1  
  - **OpenStreetMap Tile API (`https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`)**  
- **バックエンド**  
  - Laravel 11  
  - Inertia.js  
  - Laravel Sanctum (認証)  
  - Laravel Breeze  
- **フロントエンド**  
  - React 18  
  - Vite 6  
  - Tailwind CSS 3.2.1  
  - Ziggy 2.0 (ルーティング)

## **技術面でアドバイスして欲しいポイント**  

### **① `HeaderLayout.jsx`（resources/js/Layouts/HeaderLayout.jsx）**  
#### **質問:**  
画面遷移時に、ログインしている場合でもヘッダーの項目が1~2秒ほど「ログイン」「新規登録」「店舗検索」と表示されてしまいます。  

#### **現在の仕様:**  
- **ログインしている時の表示:**  
  - 店舗検索  
  - うまー！履歴  
  - ログアウト  

- **ログインしていない時の表示:**  
  - ログイン  
  - 新規登録  
  - 店舗検索  

現在、`useEffect` を使用して `fetchUserId` 関数を呼び出し、ユーザーIDを取得していますが、
この処理に時間がかかるため、初めにログインしていない状態のヘッダーが表示されてしまいます。  
改善方法のアドバイスをいただきたいです。 

### **② `UserToken.jsx`（resources/js/Components/UserToken.jsx）**  
#### **質問:**  
現在、ユーザートークンをローカルストレージに保存していますが、
クロスサイトスクリプティング攻撃によりトークンが盗まれるリスクがあるので、危険だと感じています。
どのように改善すれば良いかアドバイスをいただきたいです。

## **自己評価**

### **良かった点**
今回の開発では、1日単位でやることを決め、さらに30分〜1時間ごとにタスクを細分化することで、時間を無駄にせず効率的に進めることができました。  
具体的には、検索機能の実装時には以下のような流れで作業を進めました。

- **1時間半:** ホットペッパーグルメAPIを試しながら検索条件を決定  
- **1時間:** 過去のプロジェクトを参考にしながら、検索条件のUI（カード・リストボックス）を作成  
- **1時間:** APIのレスポンスを実際に画面へ表示  

このように、タスクを短時間で区切ることでモチベーションを維持しやすくなり、つまずいている点も明確になりました。  
しかし、実装を終えた後に「もっと効率的で読みやすいコードにできる」と気づくことがあり、1日のタスク完了後にコードを振り返る時間を確保するべきだったと考えています。

### **悪かった点**
当初の目標は「環境構築・検索機能・マップ表示・店舗詳細の実装」を完了させることでしたが、想定よりも早く進みました。
これは、個人面談で技術選考ではAPIを扱うと聞いていたため、半年間にわたりAPIやReact、Laravelの学習を進めていたことが影響しています。
また、一日のタスクを終えても「もう少し進めよう」と作業時間を増やした結果、開発スケジュールが崩れがちになってしまいました。

その結果、バグ修正やドキュメント整理、コードの可読性確認を除いた4日間の時間が余ったため、  
その期間で「うまー！（いいね）」機能を追加することを決めました。
過去に認証機能を実装した経験を活かせばギリギリ間に合うと判断し、実装を進めましたが、結果的にカツカツのスケジュールになってしまいました。
また、実装の過程で公式ドキュメントを読み直し、「もっと読みやすく書けるのでは」と考えた時間もあったため、  
もしトラブルが発生していれば、スケジュール内に間に合わなかった可能性もあったと反省しています。

### **今後の反省点**
今回は最終的に間に合わせることができたが、予想よりも早く進んだ場合のスケジュールを事前に考慮できていませんでした。  
そのため、余った時間で新機能を追加することになり、無理なスケジュールを立ててしまいました。

今後は、スケジュールを立てる際に「進捗が遅れた場合」と「予定より早く進んだ場合」の両方を想定し、  
進捗通りに進まなかった時に、迅速に対応できるよう、スケジュールを立てたいと考えています。   
